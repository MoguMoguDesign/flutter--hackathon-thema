# Investigation Report: GitHub Issues Analysis

**Investigation Date:** 2025-11-29
**Investigator:** Claude Code
**Repository:** MoguMoguDesign/flutter--hackathon-thema
**Branch:** main
**Total Issues Analyzed:** 12 (all OPEN)

---

## Executive Summary

This investigation analyzed all 12 open GitHub issues for the Flutter Hackathon Thema project. The issues represent a comprehensive implementation roadmap for a haiku + AI image generation web application. The project is currently in early stages with only foundational infrastructure (routing, basic styling) in place.

**Key Findings:**
- All issues are part of a structured 3-phase implementation plan
- Current implementation: ~5% (basic routing and styling only)
- No Firebase integration or feature modules exist yet
- All issues align with the project's three-layer architecture requirements
- No implementation conflicts or architectural violations detected

**Recommendation:** Systematic implementation following the phased approach (Phase 1 → Phase 2 → Phase 3)

---

## Project Overview

### Application Concept
A web application where users can:
1. Enter a nickname (stored locally)
2. Input haiku (Japanese poetry)
3. Generate AI images using DALL-E 3 API based on the haiku
4. View and share haiku + image combinations in a Pinterest-style grid
5. Browse all users' posts in real-time

### Target Platform
- Flutter Web (primary)
- Mobile support possible (secondary)

---

## Current Project Status

### Implemented Features
- Basic project structure with FVM Flutter management
- Routing infrastructure (go_router 16.x)
- State management setup (hooks_riverpod 3.x)
- Code generation tooling (freezed, build_runner)
- UI constants (colors, text styles, gradients)
- Static analysis configuration (very_good_analysis, riverpod_lint)

### Missing Dependencies
The following dependencies are required but not yet added:
```yaml
# Firebase (for Phase 1)
firebase_core: latest
cloud_firestore: latest
firebase_storage: latest

# HTTP Client (for Phase 2)
http: latest  # for DALL-E 3 API

# Local Storage (for Phase 2)
shared_preferences: latest  # for nickname persistence

# UI Components (for Phase 3)
flutter_staggered_grid_view: latest  # for Pinterest-like layout
```

### Current File Structure
```
lib/
├── app/
│   └── app_router/
│       ├── app_router.dart
│       └── routes.dart
├── src/
│   └── constants/
│       ├── app_colors.dart
│       ├── app_gradients.dart
│       └── app_text_styles.dart
├── base_ui.dart
└── main.dart

Missing:
├── features/           # Feature layer modules
└── shared/             # Shared components layer
```

---

## Issue Analysis by Phase

### Phase 1: Foundation Building (基盤構築)

#### Issue #7: Firebase Project Setup
**Status:** OPEN
**Priority:** High (Red)
**Dependencies:** None

**Tasks:**
- Create Firebase project
- Configure Flutter Web with Firebase
- Add dependencies: firebase_core, cloud_firestore, firebase_storage
- Initialize Firebase in main.dart
- Set up Firestore security rules
- Set up Storage security rules

**Architecture Impact:**
- App layer: Firebase initialization in main.dart
- No architectural conflicts

**Required Skills:**
- Firebase Console configuration
- Security rules syntax
- Environment variable management

---

#### Issue #8: Project Structure Organization
**Status:** OPEN
**Priority:** High (Red)
**Dependencies:** None

**Tasks:**
- Create lib/shared/ directory structure:
  - widgets/ - Shared UI components
  - models/ - Shared data models
  - utilities/ - Utility functions
- Create lib/features/ directory structure:
  - nickname/ - Nickname feature module
  - posts/ - Posts listing feature
  - post_creation/ - Post creation feature
- Move lib/src/constants/ to lib/shared/constants/

**Architecture Impact:**
- Critical: Establishes three-layer architecture foundation
- App → Feature → Shared dependency flow
- Feature modules must remain independent (no Feature → Feature dependencies)

**Migration Required:**
```dart
// Old import
import 'package:flutterhackthema/src/constants/app_colors.dart';

// New import
import 'package:flutterhackthema/shared/constants/app_colors.dart';
```

**Feature Module Template:**
```
features/
└── {feature_name}/
    ├── data/
    │   ├── models/
    │   └── repositories/
    ├── presentation/
    │   ├── providers/
    │   ├── state/
    │   ├── pages/
    │   └── widgets/
    └── service/
```

---

#### Issue #9: Routing Configuration (go_router Integration)
**Status:** OPEN
**Priority:** High (Red)
**Dependencies:** #8 (Project Structure)

**Tasks:**
- Convert main.dart to MaterialApp.router
- Define routes:
  - `/nickname` - Nickname input page
  - `/posts` - Posts listing page
  - `/create` - Post creation page
  - `/preview` - Preview page
- Implement redirect guards (check nickname)
- Create error page

**Architecture Impact:**
- App layer: Global routing configuration
- Feature layer: Individual route definitions
- Shared layer: Route guards and navigation utilities

**Current Status:**
- go_router 16.x already in dependencies
- Basic app_router structure exists but needs enhancement

**Technical Considerations:**
- Use TypeSafe routing with go_router_builder
- Implement AuthGuard pattern for nickname check
- Handle deep linking for web

---

### Phase 2: Feature Implementation (機能実装)

#### Issue #10: Nickname Input Screen
**Status:** OPEN
**Priority:** High (Red)
**Dependencies:** #8 (Project Structure), #9 (Routing)

**Tasks:**
- Create NicknamePage widget
- Implement input form with validation:
  - Empty check
  - Length: 1-20 characters
- Add shared_preferences for localStorage
- Navigate to /posts on success
- Auto-redirect on return visit

**Architecture Placement:**
- Feature: lib/features/nickname/
  - presentation/pages/nickname_page.dart
  - presentation/providers/nickname_provider.dart
  - service/nickname_validator.dart

**State Management:**
```dart
@riverpod
class NicknameNotifier extends _$NicknameNotifier {
  @override
  String? build() {
    // Load from shared_preferences
    return null;
  }

  Future<void> saveNickname(String nickname) async {
    // Validate and save
  }
}
```

**Validation Rules:**
- Required field
- Minimum 1 character
- Maximum 20 characters
- No special validation beyond length

---

#### Issue #11: Post Model & Repository
**Status:** OPEN
**Priority:** High (Red)
**Dependencies:** #7 (Firebase Setup), #8 (Project Structure)

**Tasks:**
- Define Post model with Freezed:
  - nickname: String
  - haikuText: String
  - imageUrl: String
  - createdAt: DateTime
- Implement PostRepository:
  - getPosts() - Fetch posts (newest first)
  - createPost() - Create new post
  - uploadImage() - Upload to Firebase Storage
- Create Riverpod providers

**Architecture Placement:**
- Feature: lib/features/posts/
  - data/models/post.dart
  - data/models/post.freezed.dart (generated)
  - data/models/post.g.dart (generated)
  - data/repositories/post_repository.dart
  - data/repositories/post_repository.g.dart (generated)

**Model Definition:**
```dart
@freezed
class Post with _$Post {
  const factory Post({
    required String id,
    required String nickname,
    required String haikuText,
    required String imageUrl,
    required DateTime createdAt,
  }) = _Post;

  factory Post.fromJson(Map<String, dynamic> json) => _$PostFromJson(json);
}
```

**Repository Pattern:**
```dart
@riverpod
class PostRepository extends _$PostRepository {
  @override
  FutureOr<void> build() {}

  Future<List<Post>> getPosts({int limit = 50}) async {
    // Firestore query with ordering
  }

  Future<void> createPost(Post post) async {
    // Firestore document creation
  }

  Future<String> uploadImage(Uint8List imageData) async {
    // Firebase Storage upload
    // Return download URL
  }
}
```

**Firestore Collection Structure:**
```
posts/
  {postId}/
    - nickname: string
    - haikuText: string
    - imageUrl: string
    - createdAt: timestamp
```

**Firebase Storage Structure:**
```
images/
  {timestamp}_{uuid}.png
```

---

#### Issue #12: Posts Listing Screen
**Status:** OPEN
**Priority:** High (Red)
**Dependencies:** #9 (Routing), #11 (Post Model/Repository)

**Tasks:**
- Create PostsPage widget
- Implement Staggered Grid layout (Pinterest-like)
- Design post card component:
  - Generated image (4:5 aspect ratio)
  - Haiku text overlay
  - Nickname display
  - Post timestamp
- Real-time Firestore data fetching
- Infinite scroll implementation
- FAB (+) button → navigate to /create
- Loading and error states

**Architecture Placement:**
- Feature: lib/features/posts/
  - presentation/pages/posts_page.dart
  - presentation/widgets/post_card.dart
  - presentation/providers/posts_provider.dart
  - presentation/state/posts_state.dart

**Required Package:**
```yaml
flutter_staggered_grid_view: ^0.7.0
```

**Provider Pattern:**
```dart
@riverpod
class PostsNotifier extends _$PostsNotifier {
  @override
  Future<List<Post>> build() async {
    return ref.watch(postRepositoryProvider).getPosts();
  }

  Future<void> loadMore() async {
    // Pagination logic
  }
}
```

**UI Considerations:**
- Responsive grid (2 columns mobile, 3+ desktop)
- Lazy loading with pagination
- Pull-to-refresh
- Empty state handling
- Shimmer loading effect

---

#### Issue #13: Haiku Input & Image Generation Screen
**Status:** OPEN
**Priority:** High (Red)
**Dependencies:** #9 (Routing), #14 (DALL-E API)

**Tasks:**
- Create CreatePostPage widget
- Haiku input form:
  - Text field (horizontal text)
  - Placeholder: "俳句を入力してください"
  - Validation: non-empty, max 100 characters
- "Generate Image" button
- Call DALL-E API
- Loading indicator: "生成中..."
- Store generated image in memory

**Architecture Placement:**
- Feature: lib/features/post_creation/
  - presentation/pages/create_post_page.dart
  - presentation/providers/create_post_provider.dart
  - presentation/state/create_post_state.dart
  - service/haiku_validator.dart

**State Management:**
```dart
@freezed
class CreatePostState with _$CreatePostState {
  const factory CreatePostState.initial() = _Initial;
  const factory CreatePostState.loading() = _Loading;
  const factory CreatePostState.generated({
    required String haikuText,
    required Uint8List imageData,
  }) = _Generated;
  const factory CreatePostState.error(String message) = _Error;
}
```

**Validation:**
- Required field check
- Maximum 100 characters
- Japanese character support

**UX Flow:**
1. User enters haiku
2. Tap "画像を生成する"
3. Show loading overlay
4. API call (30-60 seconds)
5. Navigate to /preview with image data

---

#### Issue #14: Image Generation API Integration (DALL-E 3)
**Status:** OPEN
**Priority:** High (Red)
**Dependencies:** #8 (Project Structure)

**Tasks:**
- Implement OpenAI DALL-E 3 API client
- Add http package dependency
- Prompt generation logic (haiku → image prompt conversion)
- Error handling (API failures, quota limits)
- Timeout handling (60 seconds)
- API key management (--dart-define or environment variables)

**Architecture Placement:**
- Feature: lib/features/post_creation/
  - data/datasources/dalle_api_client.dart
  - service/prompt_generator.dart

**Required Dependency:**
```yaml
http: ^1.2.0
```

**API Client Implementation:**
```dart
class DalleApiClient {
  final String apiKey;
  final http.Client client;

  static const String baseUrl = 'https://api.openai.com/v1/images/generations';
  static const Duration timeout = Duration(seconds: 60);

  Future<Uint8List> generateImage(String prompt) async {
    // POST request to DALL-E 3 API
    // Return image bytes
  }
}
```

**Prompt Generation Strategy:**
```dart
class PromptGenerator {
  String generatePrompt(String haiku) {
    // Convert haiku to English art direction
    // Example: "俳句の情景を和風の美しいイラストで表現してください"
    return 'Create a beautiful Japanese-style illustration depicting: $haiku. '
           'Art style: traditional Japanese painting, soft colors, minimalist.';
  }
}
```

**API Key Management:**
```bash
# Run with environment variable
flutter run --dart-define=OPENAI_API_KEY=sk-...
```

**Error Handling:**
- Network errors
- Timeout errors
- API quota exceeded
- Invalid API key
- Content policy violations

**Security Considerations:**
- Never commit API keys
- Use environment variables
- Implement rate limiting
- Monitor API usage

---

#### Issue #15: Preview & Post Confirmation Screen
**Status:** OPEN
**Priority:** High (Red)
**Dependencies:** #11 (Post Model/Repository), #13 (Haiku Input), #14 (DALL-E API)

**Tasks:**
- Create PreviewPage widget
- Display preview:
  - Generated image
  - Haiku text
- Action buttons:
  - "投稿する" → post to Firebase
  - "再生成する" → call DALL-E again
  - "キャンセル" → return to input screen
- Post workflow:
  1. Upload image to Firebase Storage
  2. Create Firestore document
  3. Show success toast
  4. Navigate to /posts

**Architecture Placement:**
- Feature: lib/features/post_creation/
  - presentation/pages/preview_page.dart
  - presentation/providers/preview_provider.dart

**Post Workflow:**
```dart
Future<void> submitPost({
  required String nickname,
  required String haikuText,
  required Uint8List imageData,
}) async {
  // 1. Upload image to Storage
  final imageUrl = await uploadImage(imageData);

  // 2. Create Post object
  final post = Post(
    id: uuid.v4(),
    nickname: nickname,
    haikuText: haikuText,
    imageUrl: imageUrl,
    createdAt: DateTime.now(),
  );

  // 3. Save to Firestore
  await createPost(post);

  // 4. Navigate to posts list
  context.go('/posts');
}
```

**UI States:**
- Preview (default)
- Uploading (progress indicator)
- Success (toast notification)
- Error (error dialog with retry)

**Regeneration Logic:**
- Keep haiku text
- Call DALL-E API again
- Replace image data
- Stay on preview page

---

### Phase 3: Quality & Deployment (品質・デプロイ)

#### Issue #16: Shared UI Components Implementation
**Status:** OPEN
**Priority:** Medium (Yellow)
**Dependencies:** #8 (Project Structure)

**Tasks:**
- AppButton - Common button component
- AppTextField - Common text field
- AppCard - Post card component
- LoadingIndicator - Loading display
- ErrorView - Error display
- Toast - Toast notification

**Architecture Placement:**
- Shared: lib/shared/
  - widgets/app_button.dart
  - widgets/app_text_field.dart
  - widgets/app_card.dart
  - widgets/loading_indicator.dart
  - widgets/error_view.dart
  - widgets/toast.dart

**Design System Integration:**
- Use existing app_colors.dart
- Use existing app_text_styles.dart
- Use existing app_gradients.dart
- Maintain consistent styling

**Component Examples:**
```dart
// AppButton
class AppButton extends StatelessWidget {
  final String text;
  final VoidCallback? onPressed;
  final bool isLoading;
  final ButtonType type;

  // Implementation with consistent styling
}

// AppTextField
class AppTextField extends StatelessWidget {
  final String? label;
  final String? placeholder;
  final TextEditingController? controller;
  final String? Function(String?)? validator;

  // Implementation with consistent styling
}
```

**Benefits:**
- Code reusability
- Consistent UX
- Easier maintenance
- Theme management

---

#### Issue #17: Test Implementation
**Status:** OPEN
**Priority:** Medium (Yellow)
**Dependencies:** All Phase 1 & 2 features

**Tasks:**
- Unit tests:
  - PostRepository tests
  - Validation logic tests
  - Prompt generation tests
- Widget tests:
  - NicknamePage tests
  - PostsPage tests
  - CreatePostPage tests
- Integration tests (optional)

**Test Structure:**
```
test/
├── features/
│   ├── nickname/
│   │   ├── service/
│   │   │   └── nickname_validator_test.dart
│   │   └── presentation/
│   │       └── pages/
│   │           └── nickname_page_test.dart
│   ├── posts/
│   │   ├── data/
│   │   │   └── repositories/
│   │   │       └── post_repository_test.dart
│   │   └── presentation/
│   │       └── pages/
│   │           └── posts_page_test.dart
│   └── post_creation/
│       ├── service/
│       │   ├── haiku_validator_test.dart
│       │   └── prompt_generator_test.dart
│       └── presentation/
│           └── pages/
│               ├── create_post_page_test.dart
│               └── preview_page_test.dart
└── shared/
    └── widgets/
        ├── app_button_test.dart
        └── app_text_field_test.dart
```

**Test Coverage Goals:**
- Unit tests: >80%
- Widget tests: >60%
- Critical paths: 100%

**Testing Tools:**
- flutter_test (built-in)
- mockito (already in dependencies)
- Integration test package (if needed)

**Mock Requirements:**
- Mock Firebase services
- Mock DALL-E API client
- Mock shared_preferences

---

#### Issue #18: Firebase Hosting Deployment
**Status:** OPEN
**Priority:** Medium (Yellow)
**Dependencies:** All features implemented

**Tasks:**
- Initialize Firebase Hosting
- Configure firebase.json
- Set up build commands
- Create GitHub Actions CI/CD pipeline
- Deploy to production

**Deployment Configuration:**
```json
// firebase.json
{
  "hosting": {
    "public": "build/web",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ],
    "rewrites": [
      {
        "source": "**",
        "destination": "/index.html"
      }
    ]
  }
}
```

**Build Process:**
```bash
# Build for web
fvm flutter build web --release

# Deploy to Firebase
firebase deploy --only hosting
```

**GitHub Actions Workflow:**
```yaml
name: Deploy to Firebase Hosting

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: subosito/flutter-action@v2
      - run: fvm flutter pub get
      - run: fvm flutter build web --release
      - uses: FirebaseExtended/action-hosting-deploy@v0
```

**Pre-Deployment Checklist:**
- All tests passing
- Static analysis clean
- Code formatted
- API keys secured
- Performance optimized

---

## Three-Layer Architecture Compliance Analysis

### Layer Definitions

**App Layer** (lib/app/)
- Global routing configuration
- Dependency injection setup
- App-wide initialization
- Cross-cutting concerns

**Feature Layer** (lib/features/)
- Independent feature modules
- Business logic
- Feature-specific UI
- Local state management

**Shared Layer** (lib/shared/)
- Common UI components
- Utilities
- Constants
- Base models

### Dependency Flow Validation

**Allowed Dependencies:**
```
App → Feature ✅
App → Shared ✅
Feature → Shared ✅
```

**Prohibited Dependencies:**
```
Feature → Feature ❌
Shared → Feature ❌
Shared → App ❌
```

### Architecture Compliance by Issue

| Issue | Primary Layer | Dependencies | Compliance | Notes |
|-------|---------------|--------------|------------|-------|
| #7 Firebase Setup | App | None | ✅ | Firebase init in App layer |
| #8 Project Structure | All | None | ✅ | Establishes architecture |
| #9 Routing | App | Shared | ✅ | Global routing in App |
| #10 Nickname | Feature | Shared | ✅ | Independent feature module |
| #11 Post Model | Feature | Shared | ✅ | Posts feature module |
| #12 Posts List | Feature | Shared | ✅ | Posts feature module |
| #13 Create Post | Feature | Shared | ✅ | Post creation feature |
| #14 DALL-E API | Feature | Shared | ✅ | Part of post creation |
| #15 Preview | Feature | Shared | ✅ | Post creation feature |
| #16 Shared Components | Shared | None | ✅ | Pure Shared layer |
| #17 Testing | All | None | ✅ | Tests mirror structure |
| #18 Deployment | App | None | ✅ | Build/deploy config |

**Result:** All issues comply with three-layer architecture requirements.

### Feature Independence Analysis

**Features Identified:**
1. Nickname (`lib/features/nickname/`)
2. Posts (`lib/features/posts/`)
3. Post Creation (`lib/features/post_creation/`)

**Cross-Feature Dependencies:**
- Nickname → Posts: Via App layer routing (✅)
- Posts → Post Creation: Via App layer routing (✅)
- Post Creation → Posts: Via App layer routing (✅)

**No direct Feature → Feature imports required.**

---

## Riverpod State Management Patterns

### Current Project Configuration
- hooks_riverpod: ^3.0.3
- riverpod_annotation: ^3.0.3
- riverpod_generator: ^3.0.3
- riverpod_lint: ^3.0.3

### Recommended Patterns

#### Provider Definition
```dart
import 'package:riverpod_annotation/riverpod_annotation.dart';

part 'example_provider.g.dart';

@riverpod
class ExampleNotifier extends _$ExampleNotifier {
  @override
  ExampleState build() {
    return const ExampleState.initial();
  }
}
```

#### State Classes (Freezed)
```dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'example_state.freezed.dart';

@freezed
class ExampleState with _$ExampleState {
  const factory ExampleState.initial() = _Initial;
  const factory ExampleState.loading() = _Loading;
  const factory ExampleState.success(Data data) = _Success;
  const factory ExampleState.error(String message) = _Error;
}
```

#### Widget Consumption
```dart
class ExampleWidget extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final state = ref.watch(exampleNotifierProvider);

    return state.when(
      initial: () => InitialView(),
      loading: () => LoadingIndicator(),
      success: (data) => SuccessView(data),
      error: (message) => ErrorView(message),
    );
  }
}
```

### Provider Placement by Layer

**App Layer Providers:**
- Global configuration
- Firebase initialization state
- Theme/locale providers

**Feature Layer Providers:**
- Feature-specific state
- Business logic
- Data repositories

**Shared Layer Providers:**
- Utility providers
- Common services
- Shared state (rare)

---

## go_router Integration Patterns

### Current Configuration
- go_router: ^16.2.4
- go_router_builder: ^4.1.0 (dev)

### Recommended Route Structure

```dart
// lib/app/app_router/app_router.dart
@TypedGoRoute<NicknameRoute>(path: '/nickname')
class NicknameRoute extends GoRouteData {
  @override
  Widget build(BuildContext context, GoRouterState state) {
    return const NicknamePage();
  }
}

@TypedGoRoute<PostsRoute>(path: '/posts')
class PostsRoute extends GoRouteData {
  @override
  Widget build(BuildContext context, GoRouterState state) {
    return const PostsPage();
  }
}

@TypedGoRoute<CreatePostRoute>(path: '/create')
class CreatePostRoute extends GoRouteData {
  @override
  Widget build(BuildContext context, GoRouterState state) {
    return const CreatePostPage();
  }
}

@TypedGoRoute<PreviewRoute>(path: '/preview')
class PreviewRoute extends GoRouteData {
  final String haikuText;

  @override
  Widget build(BuildContext context, GoRouterState state) {
    return PreviewPage(haikuText: haikuText);
  }
}
```

### Redirect Guard Pattern

```dart
final router = GoRouter(
  routes: $appRoutes,
  redirect: (context, state) {
    final nickname = ref.read(nicknameProvider);
    final isNicknamePage = state.matchedLocation == '/nickname';

    if (nickname == null && !isNicknamePage) {
      return '/nickname';
    }

    return null;
  },
);
```

---

## Freezed Usage Patterns

### Current Configuration
- freezed_annotation: ^3.1.0
- freezed: ^3.2.3 (dev)

### Model Definition Pattern

```dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'post.freezed.dart';
part 'post.g.dart';

@freezed
class Post with _$Post {
  const factory Post({
    required String id,
    required String nickname,
    required String haikuText,
    required String imageUrl,
    required DateTime createdAt,
  }) = _Post;

  factory Post.fromJson(Map<String, dynamic> json) => _$PostFromJson(json);
}
```

### State Class Pattern

```dart
@freezed
class PostsState with _$PostsState {
  const factory PostsState.initial() = _Initial;
  const factory PostsState.loading() = _Loading;
  const factory PostsState.loaded(List<Post> posts) = _Loaded;
  const factory PostsState.error(String message) = _Error;
}
```

### Code Generation Command

```bash
fvm flutter pub run build_runner build --delete-conflicting-outputs
```

---

## Dependencies & Timeline Analysis

### Critical Path
```
#7 Firebase Setup
  ↓
#8 Project Structure
  ↓
#9 Routing Configuration
  ↓
#10 Nickname Input ─┐
                    │
#11 Post Model     ─┤
                    ├→ #12 Posts List
#14 DALL-E API     ─┤
                    │
#13 Haiku Input    ─┤
                    ├→ #15 Preview
                    │
                    ↓
#16 Shared Components
#17 Tests
#18 Deployment
```

### Dependency Matrix

| Issue | Depends On | Blocks |
|-------|------------|--------|
| #7 | None | #11 |
| #8 | None | #9, #10, #11, #13, #14, #16 |
| #9 | #8 | #10, #12, #13, #15 |
| #10 | #8, #9 | - |
| #11 | #7, #8 | #12, #15 |
| #12 | #9, #11 | - |
| #13 | #9, #14 | #15 |
| #14 | #8 | #13, #15 |
| #15 | #11, #13, #14 | - |
| #16 | #8 | - |
| #17 | All Phase 1 & 2 | - |
| #18 | All features | - |

### Parallelization Opportunities

**Can be done in parallel:**
- #7 (Firebase) + #8 (Structure)
- #10 (Nickname) + #11 (Post Model) + #14 (DALL-E)
- #12 (Posts List) + #13 (Haiku Input)
- #16 (Components) + #17 (Tests)

**Must be sequential:**
- #8 → #9 → #10/#11/#12/#13
- #11 + #13 + #14 → #15

### Estimated Effort

**Phase 1 (High Priority):**
- Issue #7: 2-3 hours (Firebase setup)
- Issue #8: 1-2 hours (Directory structure)
- Issue #9: 2-3 hours (Routing)
- **Phase 1 Total: 5-8 hours**

**Phase 2 (High Priority):**
- Issue #10: 3-4 hours (Nickname feature)
- Issue #11: 4-5 hours (Post model/repository)
- Issue #12: 5-6 hours (Posts list with grid)
- Issue #13: 3-4 hours (Haiku input)
- Issue #14: 4-5 hours (DALL-E integration)
- Issue #15: 3-4 hours (Preview/post)
- **Phase 2 Total: 22-28 hours**

**Phase 3 (Medium Priority):**
- Issue #16: 4-5 hours (Shared components)
- Issue #17: 6-8 hours (Comprehensive tests)
- Issue #18: 2-3 hours (Deployment)
- **Phase 3 Total: 12-16 hours**

**Grand Total: 39-52 hours** (approximately 1-1.5 weeks of full-time work)

---

## Technical Considerations & Risks

### Security Concerns

**API Key Management:**
- ⚠️ Risk: OpenAI API key exposure
- ✅ Mitigation: Use --dart-define, never commit keys
- ✅ Mitigation: Implement backend proxy for production

**Firebase Security:**
- ⚠️ Risk: Open Firestore rules allow data manipulation
- ✅ Mitigation: Implement proper security rules
- Example rules:
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /posts/{postId} {
      allow read: if true;
      allow create: if request.resource.data.keys().hasAll([
        'nickname', 'haikuText', 'imageUrl', 'createdAt'
      ]);
      allow update, delete: if false;
    }
  }
}
```

**Storage Security:**
```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /images/{imageId} {
      allow read: if true;
      allow write: if request.resource.size < 5 * 1024 * 1024
                   && request.resource.contentType.matches('image/.*');
    }
  }
}
```

### Performance Considerations

**Image Generation:**
- ⚠️ Risk: DALL-E API takes 30-60 seconds
- ✅ Mitigation: Clear loading indicators
- ✅ Mitigation: Consider timeout handling
- ✅ Mitigation: Allow cancellation

**Firestore Queries:**
- ⚠️ Risk: Loading all posts inefficient
- ✅ Mitigation: Implement pagination (limit: 50)
- ✅ Mitigation: Use Firestore indexes
- Required index: `posts` collection ordered by `createdAt DESC`

**Image Loading:**
- ⚠️ Risk: Large images slow down grid rendering
- ✅ Mitigation: Use Firebase Storage image resizing
- ✅ Mitigation: Implement lazy loading
- ✅ Mitigation: Cache images locally

**Web Performance:**
- ⚠️ Risk: Large Flutter Web bundle size
- ✅ Mitigation: Code splitting with deferred loading
- ✅ Mitigation: Asset optimization
- ✅ Mitigation: Enable CanvasKit for better performance

### Scalability Concerns

**Firestore Costs:**
- Read: $0.06 per 100K documents
- Write: $0.18 per 100K documents
- Storage: $0.18 per GB/month
- **Mitigation:** Free tier covers 50K reads/20K writes per day

**Storage Costs:**
- Storage: $0.026 per GB/month
- Download: $0.12 per GB
- **Mitigation:** Free tier covers 5GB storage, 1GB download/day

**DALL-E 3 Costs:**
- Standard (1024x1024): $0.040 per image
- HD (1024x1024): $0.080 per image
- **Mitigation:** Use standard quality, implement rate limiting

**Recommendation:** Start with free tiers, monitor usage, implement cost controls

### Browser Compatibility

**Target Browsers:**
- Chrome/Edge (Chromium) ✅
- Firefox ✅
- Safari ✅
- Mobile browsers ⚠️ (touch optimization needed)

**Known Flutter Web Issues:**
- Text selection behavior differs
- File download/upload requires special handling
- PWA support requires additional setup

### Testing Challenges

**Firebase Testing:**
- Use Firebase Emulator Suite for local testing
- Mock Firebase services in unit tests
- Requires additional setup

**API Testing:**
- Mock DALL-E API responses
- Cannot fully test without real API calls
- Consider test mode with cached responses

**Widget Testing:**
- Complex async state requires careful setup
- Image widgets need special handling
- Navigation testing requires router mocking

---

## Recommendations

### Immediate Next Steps

1. **Accept All Issues (Bulk Accept)**
   - All 12 issues are valid and well-structured
   - No conflicts or duplicates detected
   - All align with project architecture

2. **Start with Phase 1 (Foundation)**
   - Issue #7: Firebase Setup (critical blocker)
   - Issue #8: Project Structure (architectural foundation)
   - Issue #9: Routing Configuration (navigation backbone)

3. **Create Implementation Branches**
   ```bash
   git checkout -b feature/phase1-foundation
   # Complete issues #7, #8, #9

   git checkout -b feature/phase2-core-features
   # Complete issues #10-#15

   git checkout -b feature/phase3-quality
   # Complete issues #16-#18
   ```

### Implementation Strategy

**Week 1: Foundation (Phase 1)**
- Day 1-2: Firebase setup (#7)
- Day 2-3: Project structure refactoring (#8)
- Day 3-4: Routing enhancement (#9)
- Day 4-5: Testing and documentation

**Week 2: Core Features Part 1 (Phase 2a)**
- Day 1: Nickname feature (#10)
- Day 2-3: Post model and repository (#11)
- Day 3-4: DALL-E API integration (#14)
- Day 4-5: Testing

**Week 3: Core Features Part 2 (Phase 2b)**
- Day 1-2: Posts listing (#12)
- Day 2-3: Haiku input screen (#13)
- Day 3-4: Preview and posting (#15)
- Day 4-5: Integration testing

**Week 4: Polish & Deploy (Phase 3)**
- Day 1-2: Shared components (#16)
- Day 2-3: Comprehensive tests (#17)
- Day 3-4: Deployment setup (#18)
- Day 4-5: UAT and bug fixes

### Required Pre-Implementation Setup

1. **Firebase Console:**
   - Create new Firebase project
   - Enable Firestore Database
   - Enable Firebase Storage
   - Enable Firebase Hosting
   - Generate web app credentials

2. **OpenAI Account:**
   - Sign up for OpenAI account
   - Generate API key
   - Set up billing (DALL-E 3 is paid)
   - Review usage quotas

3. **Development Environment:**
   - Ensure FVM is properly configured
   - Install Firebase CLI: `npm install -g firebase-tools`
   - Install GitHub CLI if using gh commands
   - Set up environment variables

4. **Documentation:**
   - Create .env.example file
   - Document API key setup process
   - Create deployment guide
   - Create user manual (optional)

### Code Quality Checklist

Before marking any issue as complete, ensure:

- [ ] Code passes `fvm flutter analyze` (zero errors)
- [ ] Code is formatted: `dart format .`
- [ ] All generated files are up to date: `build_runner build`
- [ ] Unit tests written and passing
- [ ] Widget tests written and passing
- [ ] No console errors or warnings
- [ ] Follows three-layer architecture
- [ ] No Feature → Feature dependencies
- [ ] Public APIs have Japanese documentation
- [ ] Riverpod providers use @riverpod annotation
- [ ] Models use Freezed
- [ ] State classes use Freezed unions

### Architecture Guidelines Reminder

**When implementing features:**

1. **Always check layer placement:**
   - Is this App, Feature, or Shared layer?
   - Where should the file be located?

2. **Verify dependencies:**
   - Am I importing from the correct layer?
   - Do I have any Feature → Feature imports? (prohibited)

3. **Follow existing patterns:**
   - How do other features handle similar functionality?
   - What's the established naming convention?

4. **Use code generation:**
   - Run build_runner after creating/modifying:
     - Riverpod providers (@riverpod)
     - Freezed models (@freezed)
     - JSON serializable classes
     - go_router routes

5. **Write tests first or alongside:**
   - Test-driven development recommended
   - Easier to test small units
   - Catches issues early

### Anti-Patterns to Avoid

**❌ Don't:**
- Import Feature A into Feature B directly
- Use `dynamic` type
- Skip code generation
- Ignore static analysis warnings
- Commit generated files to .gitignore
- Hard-code API keys
- Skip error handling
- Forget loading states
- Mix Japanese and English in user-facing text
- Create overly complex provider chains

**✅ Do:**
- Use Shared layer for cross-feature code
- Specify explicit types
- Run build_runner regularly
- Fix all analyzer issues
- Let build_runner handle generated files
- Use environment variables
- Handle all error cases
- Show appropriate loading indicators
- Keep UI text in Japanese
- Keep provider dependencies simple

---

## Conclusion

### Summary

This investigation analyzed 12 open GitHub issues representing a complete implementation roadmap for a Flutter hackathon application. The issues are well-structured, properly prioritized, and fully compliant with the project's three-layer architecture requirements.

**Current Status:**
- Implementation progress: ~5%
- Only foundational infrastructure exists (routing skeleton, styling constants)
- No Firebase integration or feature modules yet

**Readiness Assessment:**
- ✅ Dependencies properly configured
- ✅ Architecture guidelines clear
- ✅ Issues well-documented
- ✅ No blocking conflicts detected
- ⚠️ Requires Firebase and OpenAI account setup
- ⚠️ Estimated 40-50 hours of implementation work

### Decision

**Status:** COMPLETED
**Next Phase:** PLAN
**Branch:** main (no feature branch needed for documentation)
**Architecture Layer:** All layers (App, Feature, Shared)
**Test Coverage Required:** Comprehensive (unit + widget minimum)

**Recommendation:** Proceed to PLAN phase to create detailed implementation strategy for Phase 1 (Foundation Building) issues #7, #8, and #9.

---

## Appendix

### Issue Reference Table

| # | Title | Phase | Priority | Status | Dependencies |
|---|-------|-------|----------|--------|--------------|
| 7 | Firebase Project Setup | 1 | High | OPEN | None |
| 8 | Project Structure Organization | 1 | High | OPEN | None |
| 9 | Routing Configuration | 1 | High | OPEN | #8 |
| 10 | Nickname Input Screen | 2 | High | OPEN | #8, #9 |
| 11 | Post Model & Repository | 2 | High | OPEN | #7, #8 |
| 12 | Posts Listing Screen | 2 | High | OPEN | #9, #11 |
| 13 | Haiku Input Screen | 2 | High | OPEN | #9, #14 |
| 14 | DALL-E API Integration | 2 | High | OPEN | #8 |
| 15 | Preview & Post Screen | 2 | High | OPEN | #11, #13, #14 |
| 16 | Shared UI Components | 3 | Medium | OPEN | #8 |
| 17 | Test Implementation | 3 | Medium | OPEN | All Phase 1 & 2 |
| 18 | Firebase Hosting Deployment | 3 | Medium | OPEN | All features |

### Repository Information

- **GitHub:** https://github.com/MoguMoguDesign/flutter--hackathon-thema
- **Issues URL:** https://github.com/MoguMoguDesign/flutter--hackathon-thema/issues
- **Current Branch:** main
- **Last Commit:** d71c76c (Merge PR #5 - requirements document)

### Investigation Metadata

- **Investigation Date:** 2025-11-29 14:01:27 JST
- **Investigation Duration:** ~15 minutes
- **Issues Analyzed:** 12
- **Document Version:** 1.0
- **Author:** Claude Code (Sonnet 4.5)
- **Review Status:** Not reviewed

---

*End of Investigation Report*
