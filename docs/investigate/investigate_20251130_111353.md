# Investigation Report: Post Detail Screen Implementation

**Issue:** [#44] ã¿ã‚“ãªã®æŠ•ç¨¿ã®è©³ç´°ç”»é¢ã‚’å®Ÿè£…ã™ã‚‹ (Implement Post Detail Screen)
**Branch:** feat/shousaigamen
**Investigator:** Claude Code
**Date:** 2025-11-30
**Status:** COMPLETED
**Next Phase:** PLAN
**Architecture Layer:** Feature (haiku)
**Test Coverage Required:** Comprehensive

---

## 1. Executive Summary

### 1.1 Investigation Scope

GitHub issue #44 requires implementing a post detail screen at `/posts/:postId` with the following core functionalities:
- Fetch and display post data from Firestore
- Show author nickname, haiku text, image (4:5 aspect ratio), and like count
- Like button functionality with count increment
- Navigation back to post list
- Loading state with `CircularProgressIndicator`
- Error handling with retry option

### 1.2 Key Findings

| Finding | Status | Impact |
|---------|--------|--------|
| Branch `feat/shousaigamen` exists | âœ… Ready | Can continue on existing branch |
| Basic UI already implemented | âš ï¸ Partial | Needs Firestore integration |
| Routing `/posts/:haikuId` configured | âœ… Ready | No routing changes needed |
| `FirestoreRepository.read()` available | âœ… Ready | Can fetch individual haiku |
| Like functionality missing | âŒ Missing | Requires model and repository updates |
| Riverpod provider missing | âŒ Missing | Needs detail-specific provider |
| Freezed state missing | âŒ Missing | Needs state class creation |
| Tests missing | âŒ Missing | Requires comprehensive test coverage |

### 1.3 Recommendation

**Proceed to PLAN phase** - Implementation is recommended with comprehensive architecture compliance and testing requirements.

---

## 2. Current State Analysis

### 2.1 Existing Implementation

#### File: `lib/features/haiku/presentation/pages/haiku_detail_page.dart`

**Status:** Basic UI implemented, but data is hardcoded

**Current Implementation:**
- Widget type: `StatelessWidget` (needs change to `HookConsumerWidget`)
- Data source: Hardcoded `HaikuModel` (line 40-47)
- TODO comment present: "TODO: Firestore integration for haiku details"
- Missing features:
  - Like button
  - Like count display
  - Firestore data fetching
  - Loading state
  - Error handling
  - Riverpod state management

**Existing UI Components:**
- âœ… Image display with 4:5 aspect ratio
- âœ… Loading indicator for image
- âœ… Error fallback UI
- âœ… Author display (`haiku.userId`)
- âœ… SNS share buttons (X, Instagram)
- âœ… Back button navigation
- âŒ Like button (missing)
- âŒ Like count (missing)

### 2.2 Data Model Analysis

#### File: `lib/features/haiku/data/models/haiku_model.dart`

**Current Fields:**
```dart
final String id;
final String firstLine;
final String secondLine;
final String thirdLine;
final DateTime createdAt;
final String? imageUrl;
final String? userId;
```

**Required Additions:**
- âŒ `int likeCount` - Required for like functionality
- âŒ `String? nickname` - Required for author display (or fetch separately)

### 2.3 Repository Analysis

#### File: `lib/features/haiku/data/repositories/haiku_repository.dart`

**Inheritance:** `extends FirestoreRepository<HaikuModel>`

**Available Methods (from base class):**
- âœ… `Future<T?> read(String docId)` - Can fetch individual haiku
- âœ… `Stream<T?> watch(String docId)` - Can watch haiku changes
- âœ… `Future<void> update(String docId, T data)` - Can update haiku

**Required Additions:**
- âŒ `Future<void> incrementLikeCount(String haikuId)` - Increment like count in Firestore

### 2.4 Provider Analysis

#### File: `lib/features/haiku/presentation/providers/haiku_provider.dart`

**Current Providers:**
- `haikuRepositoryProvider` - Repository instance provider
- `haikuListStreamProvider` - Stream of all haikus
- `HaikuNotifier` - Saves new haikus

**Missing Providers:**
- âŒ Detail-specific provider for fetching individual haiku
- âŒ Like functionality provider

### 2.5 Routing Analysis

#### File: `lib/app/app_router/routes.dart`

**Status:** âœ… Already configured

```dart
@TypedGoRoute<HaikuDetailRoute>(path: '/posts/:haikuId')
class HaikuDetailRoute extends GoRouteData {
  const HaikuDetailRoute({required this.haikuId});
  final String haikuId;

  @override
  Widget build(BuildContext context, GoRouterState state) {
    return HaikuDetailPage(haikuId: haikuId);
  }
}
```

**No changes required** for routing configuration.

---

## 3. Architecture Compliance

### 3.1 Three-Layer Architecture

**Target Layer:** Feature Layer (`lib/features/haiku/`)

**Compliance Status:** âœ… Compliant

```
App Layer (ã‚¢ãƒ—ãƒªå±¤)
  â†“ depends on
Feature Layer (æ©Ÿèƒ½å±¤) â† [Target: haiku feature]
  â†“ depends on
Shared Layer (å…±æœ‰å±¤)
```

**Verification:**
- âœ… No Feature-to-Feature dependencies
- âœ… Uses Shared layer components (`AppScaffoldWithBackground`, `AppBackButton`, `AppFilledButton`)
- âœ… App layer provides routing configuration
- âœ… Feature is self-contained within `features/haiku/`

### 3.2 Feature Module Structure

**Current Structure:**
```
features/haiku/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ haiku_model.dart
â”‚   â”‚   â””â”€â”€ haiku_model.g.dart
â”‚   â””â”€â”€ repositories/
â”‚       â””â”€â”€ haiku_repository.dart
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”œâ”€â”€ haiku_provider.dart
â”‚   â”‚   â”œâ”€â”€ haiku_provider.g.dart
â”‚   â”‚   â”œâ”€â”€ image_generation_provider.dart
â”‚   â”‚   â””â”€â”€ image_generation_provider.g.dart
â”‚   â”œâ”€â”€ state/
â”‚   â”‚   â”œâ”€â”€ image_generation_state.dart
â”‚   â”‚   â””â”€â”€ image_generation_state.freezed.dart
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ haiku_detail_page.dart â† [Target file]
â”‚   â”‚   â”œâ”€â”€ haiku_input_page.dart
â”‚   â”‚   â”œâ”€â”€ haiku_list_page.dart
â”‚   â”‚   â”œâ”€â”€ generating_page.dart
â”‚   â”‚   â””â”€â”€ preview_page.dart
â”‚   â””â”€â”€ widgets/
â”‚       â”œâ”€â”€ haiku_card.dart
â”‚       â”œâ”€â”€ haiku_preview.dart
â”‚       â”œâ”€â”€ haiku_hint_dialog.dart
â”‚       â””â”€â”€ step_indicator.dart
â””â”€â”€ service/
    â””â”€â”€ haiku_prompt_service.dart
```

**Required Additions:**
```
presentation/
â”œâ”€â”€ providers/
â”‚   â””â”€â”€ haiku_detail_provider.dart (NEW)
â”‚   â””â”€â”€ haiku_detail_provider.g.dart (GENERATED)
â””â”€â”€ state/
    â””â”€â”€ haiku_detail_state.dart (NEW)
    â””â”€â”€ haiku_detail_state.freezed.dart (GENERATED)
```

---

## 4. Riverpod State Management Patterns

### 4.1 Existing Pattern Analysis

**Pattern:** hooks_riverpod 3.x with @riverpod annotation

**Example from `haiku_provider.dart`:**
```dart
@riverpod
class HaikuNotifier extends _$HaikuNotifier {
  @override
  FutureOr<String?> build() {
    return null;
  }

  Future<String> saveHaiku({...}) async {
    state = const AsyncValue.loading();
    state = await AsyncValue.guard(() async {
      // Implementation
    });
    // ...
  }
}
```

### 4.2 Required Provider Pattern

**Haiku Detail Provider (FutureProvider):**
```dart
@riverpod
Future<HaikuDetailState> haikuDetail(Ref ref, String haikuId) async {
  final repository = ref.watch(haikuRepositoryProvider);
  final haiku = await repository.read(haikuId);

  if (haiku == null) {
    return HaikuDetailState.error('ä¿³å¥ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
  }

  // Fetch nickname if userId exists
  String? nickname;
  if (haiku.userId != null) {
    // Nickname fetching logic
  }

  return HaikuDetailState.loaded(haiku: haiku, nickname: nickname);
}
```

**Like Notifier (StateNotifier):**
```dart
@riverpod
class LikeNotifier extends _$LikeNotifier {
  @override
  FutureOr<void> build() {}

  Future<void> incrementLike(String haikuId) async {
    state = const AsyncValue.loading();
    state = await AsyncValue.guard(() async {
      await ref.read(haikuRepositoryProvider).incrementLikeCount(haikuId);
      ref.invalidate(haikuDetailProvider(haikuId));
    });
  }
}
```

---

## 5. Freezed State Class Pattern

### 5.1 Existing Pattern Analysis

**Example from `image_generation_state.dart`:**
```dart
@freezed
class ImageGenerationState with _$ImageGenerationState {
  const factory ImageGenerationState.initial() = _Initial;
  const factory ImageGenerationState.loading() = _Loading;
  const factory ImageGenerationState.success(String imageUrl) = _Success;
  const factory ImageGenerationState.error(String message) = _Error;
}
```

### 5.2 Required State Class

**File:** `lib/features/haiku/presentation/state/haiku_detail_state.dart`

```dart
import 'package:freezed_annotation/freezed_annotation.dart';
import '../../data/models/haiku_model.dart';

part 'haiku_detail_state.freezed.dart';

@freezed
class HaikuDetailState with _$HaikuDetailState {
  const factory HaikuDetailState.initial() = _Initial;
  const factory HaikuDetailState.loading() = _Loading;
  const factory HaikuDetailState.loaded({
    required HaikuModel haiku,
    String? nickname,
  }) = _Loaded;
  const factory HaikuDetailState.error(String message) = _Error;
}
```

---

## 6. Test Pattern Analysis

### 6.1 Existing Test Patterns

#### Repository Test Pattern (`haiku_repository_test.dart`)

**Pattern:** FakeFirebaseFirestore injection

```dart
class TestHaikuRepository extends HaikuRepository {
  TestHaikuRepository({required FakeFirebaseFirestore fakeFirestore})
    : _fakeFirestore = fakeFirestore;

  final FakeFirebaseFirestore _fakeFirestore;

  @override
  FirebaseFirestore get firestore => _fakeFirestore;
}

void main() {
  group('HaikuRepository', () {
    late FakeFirebaseFirestore fakeFirestore;
    late TestHaikuRepository repository;

    setUp(() {
      fakeFirestore = FakeFirebaseFirestore();
      repository = TestHaikuRepository(fakeFirestore: fakeFirestore);
    });

    test('reads existing haiku', () async {
      // Arrange, Act, Assert
    });
  });
}
```

#### Provider Test Pattern (`haiku_provider_test.dart`)

**Pattern:** Mockito with @GenerateMocks

```dart
@GenerateMocks([HaikuRepository])
void main() {
  group('HaikuNotifier', () {
    late MockHaikuRepository mockRepository;
    late ProviderContainer container;

    setUp(() {
      mockRepository = MockHaikuRepository();
      container = ProviderContainer(
        overrides: [haikuRepositoryProvider.overrideWithValue(mockRepository)],
      );
    });

    tearDown(() {
      container.dispose();
    });

    test('saveHaiku succeeds and returns document ID', () async {
      when(mockRepository.create(any)).thenAnswer((_) async => 'doc-id');
      // Test implementation
    });
  });
}
```

### 6.2 Required Tests

**Repository Tests (`haiku_repository_test.dart`):**
- âœ… Existing: `create`, `read`, `update`, `delete`, `readAll`
- âŒ Required: `incrementLikeCount` test

**Provider Tests (NEW: `haiku_detail_provider_test.dart`):**
- Test haiku detail fetching (success, error, not found)
- Test nickname resolution
- Test like increment functionality

**Widget Tests (NEW: `haiku_detail_page_test.dart`):**
- Test loading state display
- Test loaded state with haiku data
- Test error state display
- Test like button interaction
- Test navigation back button

---

## 7. Nickname Integration Analysis

### 7.1 Current Nickname Implementation

**Repository:** `lib/features/nickname/data/repositories/nickname_repository.dart`

**Key Method:**
```dart
Future<NicknameModel?> getNickname() async {
  final String userId = await _userIdService.getUserId();
  return await read(userId);
}
```

**Provider:** `lib/features/nickname/presentation/providers/nickname_provider.dart`

```dart
@Riverpod(keepAlive: true)
class NicknameNotifier extends _$NicknameNotifier {
  @override
  Future<String?> build() async {
    final model = await _repository.getNickname();
    return model?.nickname;
  }
}
```

### 7.2 Nickname Display Strategy

**Problem:** Need to display nickname for haiku author (not current user)

**Option 1: Store nickname in HaikuModel**
- Pros: Simple, no additional Firestore queries
- Cons: Denormalized data, nickname updates won't reflect in old haikus

**Option 2: Fetch nickname separately**
- Pros: Normalized data, always up-to-date
- Cons: Additional Firestore query, requires userId to nickname mapping

**Recommended:** Option 1 (store nickname in HaikuModel)
- Matches wireframe requirement: "ä½œè€…æƒ…å ±: {ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ } ä½œ"
- Simplifies detail page implementation
- Consistent with issue requirements

### 7.3 Required Changes for Nickname

**HaikuModel:**
```dart
final String? nickname;  // ADD: Store author nickname at creation time
```

**When creating haiku (in `HaikuNotifier.saveHaiku`):**
```dart
Future<String> saveHaiku({...}) async {
  // Fetch current user's nickname
  final nickname = await ref.read(nicknameNotifierProvider.future);

  final haiku = HaikuModel(
    // ...
    userId: await ref.read(userIdServiceProvider).getUserId(),
    nickname: nickname,  // Store nickname with haiku
  );
}
```

---

## 8. Impact Assessment

### 8.1 Files to Modify

| File | Type | Changes |
|------|------|---------|
| `haiku_model.dart` | Model | Add `likeCount`, `nickname` fields |
| `haiku_model.g.dart` | Generated | Auto-regenerated |
| `haiku_repository.dart` | Repository | Add `incrementLikeCount` method |
| `haiku_provider.dart` | Provider | Update `saveHaiku` to include nickname |
| `haiku_detail_page.dart` | UI | Convert to HookConsumerWidget, add Riverpod integration |

### 8.2 Files to Create

| File | Type | Purpose |
|------|------|---------|
| `haiku_detail_state.dart` | State | Freezed state class for detail screen |
| `haiku_detail_state.freezed.dart` | Generated | Auto-generated Freezed code |
| `haiku_detail_provider.dart` | Provider | Detail screen data provider |
| `haiku_detail_provider.g.dart` | Generated | Auto-generated Riverpod code |
| `haiku_repository_test.dart` | Test | Add `incrementLikeCount` test |
| `haiku_detail_provider_test.dart` | Test | Provider unit tests |
| `haiku_detail_page_test.dart` | Test | Widget tests |

### 8.3 Breaking Changes

**None** - All changes are additive and backward compatible.

### 8.4 Migration Requirements

**Existing Data:** If haikus already exist in Firestore without `likeCount` or `nickname`:
- `likeCount`: Will default to `null`, display as 0
- `nickname`: Will default to `null`, display as "åŒ¿å" (anonymous)

**Recommendation:** Add default values in `HaikuModel.fromJson`:
```dart
factory HaikuModel.fromJson(Map<String, dynamic> json) {
  return HaikuModel(
    // ...
    likeCount: json['likeCount'] as int? ?? 0,
    nickname: json['nickname'] as String?,
  );
}
```

---

## 9. Wireframe Compliance

### 9.1 Wireframe Reference

**Source:** `docs/design/wireframe_design.md` Section 3.6 (è©³ç´°ãƒšãƒ¼ã‚¸)

**UI Requirements:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚µãƒ¼ãƒ“ã‚¹å                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ï¼œ TOPã«æˆ»ã‚‹                        â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    â”‚                       â”‚        â”‚
â”‚    â”‚        ç”»åƒ           â”‚        â”‚
â”‚    â”‚                       â”‚        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                     â”‚
â”‚    ãªã»ã‚‚ã‚Š ä½œ            â™¡ 15      â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    â”‚  ğ•  Xã§ãƒã‚¹ãƒˆã™ã‚‹      â”‚        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    â”‚  ğŸ“· Instagramã«æŠ•ç¨¿ã™ã‚‹ â”‚        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 Compliance Check

| Component | Required | Current Status |
|-----------|----------|----------------|
| Header (ã‚µãƒ¼ãƒ“ã‚¹å) | âœ… | âœ… Implemented |
| Back button (< TOPã«æˆ»ã‚‹) | âœ… | âœ… Implemented |
| Image (4:5 aspect ratio) | âœ… | âœ… Implemented |
| Author info ({nickname} ä½œ) | âœ… | âš ï¸ Shows userId, needs nickname |
| Like button (â™¡ {count}) | âœ… | âŒ Missing |
| X share button | âœ… | âœ… Implemented (stub) |
| Instagram share button | âœ… | âœ… Implemented (stub) |

**Gap:** Like button and proper nickname display

---

## 10. Risk Analysis

### 10.1 Technical Risks

| Risk | Severity | Mitigation |
|------|----------|------------|
| Firestore read costs | Medium | Use caching, optimize queries |
| Race condition on like increment | Medium | Use Firestore transaction or FieldValue.increment() |
| Nickname not found | Low | Display "åŒ¿å" as fallback |
| Image loading failures | Low | Existing fallback UI handles this |

### 10.2 Implementation Risks

| Risk | Severity | Mitigation |
|------|----------|------------|
| Breaking existing tests | Low | Run `fvm flutter test` before commit |
| Code generation errors | Low | Run `build_runner` after model changes |
| State management complexity | Medium | Follow existing provider patterns |

---

## 11. Dependencies

### 11.1 Current Dependencies (from pubspec.yaml)

**Verified Required Packages:**
- âœ… `hooks_riverpod: ^3.0.0` - State management
- âœ… `riverpod_annotation: ^3.0.0` - Provider code generation
- âœ… `freezed_annotation: ^2.4.4` - State class generation
- âœ… `go_router: ^16.0.0` - Routing
- âœ… `cloud_firestore: ^4.15.5` - Firestore integration
- âœ… `json_annotation: ^4.9.0` - JSON serialization

**Dev Dependencies:**
- âœ… `build_runner: ^2.4.13` - Code generation
- âœ… `riverpod_generator: ^3.0.0` - Riverpod code generation
- âœ… `freezed: ^2.5.7` - Freezed code generation
- âœ… `mockito: ^5.4.4` - Testing mocks
- âœ… `fake_cloud_firestore: ^3.0.1` - Firestore testing

**No new dependencies required.**

---

## 12. Code Quality Requirements

### 12.1 Mandatory Checks

All changes must pass:

```bash
# Static analysis
fvm flutter analyze

# Code formatting
dart format --set-exit-if-changed .

# All tests
fvm flutter test

# Code generation
fvm flutter pub run build_runner build --delete-conflicting-outputs
```

### 12.2 Documentation Requirements

- âœ… Japanese doc comments (`///`) on all public APIs
- âœ… File header with architecture notes
- âœ… Clear method parameter documentation

---

## 13. Implementation Checklist

### 13.1 Data Layer

- [ ] Update `HaikuModel` with `likeCount` and `nickname` fields
- [ ] Add JSON serialization for new fields with default values
- [ ] Add `incrementLikeCount(String haikuId)` to `HaikuRepository`
- [ ] Update `HaikuNotifier.saveHaiku` to include nickname
- [ ] Add repository tests for like increment

### 13.2 Presentation Layer

- [ ] Create `HaikuDetailState` with Freezed
- [ ] Create `HaikuDetailProvider` with @riverpod
- [ ] Create like increment provider
- [ ] Update `HaikuDetailPage` to HookConsumerWidget
- [ ] Integrate state management with UI
- [ ] Add loading state display
- [ ] Add error state display
- [ ] Add like button UI
- [ ] Add provider unit tests
- [ ] Add widget tests

### 13.3 Quality Assurance

- [ ] Run code generation
- [ ] Run static analysis
- [ ] Format code
- [ ] Run all tests
- [ ] Manual testing on Chrome
- [ ] Verify wireframe compliance

---

## 14. Conclusion

### 14.1 Status Summary

**Investigation Status:** âœ… COMPLETED

**Findings:**
- Branch `feat/shousaigamen` is ready for development
- Basic UI scaffold exists but requires Firestore integration
- Architecture patterns are well-established and documented
- Test patterns are comprehensive and consistent
- No architectural violations expected
- Implementation is straightforward following existing patterns

### 14.2 Recommendation

**Proceed to PLAN phase** with confidence.

**Rationale:**
1. Clear requirements from issue #44 and wireframe
2. Existing codebase provides excellent patterns to follow
3. No breaking changes required
4. Comprehensive test coverage achievable
5. Architecture compliance verified

### 14.3 Estimated Complexity

**Overall Complexity:** Medium

**Breakdown:**
- Data layer changes: Low complexity (following existing patterns)
- Provider implementation: Medium complexity (new provider pattern)
- UI integration: Medium complexity (state management)
- Testing: Medium complexity (comprehensive coverage required)
- Total implementation: 1-2 hours (as estimated in issue)

### 14.4 Next Steps

1. Review this investigation report
2. Create detailed implementation plan (`docs/plan/plan_{TIMESTAMP}.md`)
3. Execute implementation following 3-phase workflow
4. Ensure all quality gates pass
5. Create pull request

---

## Appendix A: File Structure Summary

```
lib/features/haiku/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ haiku_model.dart [MODIFY: add likeCount, nickname]
â”‚   â”‚   â””â”€â”€ haiku_model.g.dart [AUTO-REGENERATE]
â”‚   â””â”€â”€ repositories/
â”‚       â””â”€â”€ haiku_repository.dart [MODIFY: add incrementLikeCount]
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”œâ”€â”€ haiku_provider.dart [MODIFY: add nickname to saveHaiku]
â”‚   â”‚   â”œâ”€â”€ haiku_detail_provider.dart [CREATE]
â”‚   â”‚   â””â”€â”€ haiku_detail_provider.g.dart [AUTO-GENERATE]
â”‚   â”œâ”€â”€ state/
â”‚   â”‚   â”œâ”€â”€ haiku_detail_state.dart [CREATE]
â”‚   â”‚   â””â”€â”€ haiku_detail_state.freezed.dart [AUTO-GENERATE]
â”‚   â””â”€â”€ pages/
â”‚       â””â”€â”€ haiku_detail_page.dart [MODIFY: add Riverpod integration]
â””â”€â”€ service/
    â””â”€â”€ (no changes)

test/features/haiku/
â”œâ”€â”€ data/
â”‚   â””â”€â”€ repositories/
â”‚       â””â”€â”€ haiku_repository_test.dart [MODIFY: add incrementLikeCount test]
â””â”€â”€ presentation/
    â”œâ”€â”€ providers/
    â”‚   â””â”€â”€ haiku_detail_provider_test.dart [CREATE]
    â””â”€â”€ pages/
        â””â”€â”€ haiku_detail_page_test.dart [CREATE]
```

---

## Appendix B: Reference Commands

```bash
# Switch to feature branch (already on it)
git checkout feat/shousaigamen

# Run code generation
fvm flutter pub run build_runner build --delete-conflicting-outputs

# Watch mode for development
fvm flutter pub run build_runner watch --delete-conflicting-outputs

# Run tests
fvm flutter test

# Run specific test
fvm flutter test test/features/haiku/data/repositories/haiku_repository_test.dart

# Static analysis
fvm flutter analyze

# Format code
dart format --set-exit-if-changed .

# Run app
fvm flutter run -d chrome
```

---

**End of Investigation Report**

Generated by: Claude Code
Date: 2025-11-30
Architecture Layer: Feature (haiku)
Next Phase: PLAN
