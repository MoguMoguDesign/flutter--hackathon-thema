## 俳句×AI画像生成Webアプリ 要件定義書

### 概要

| 項目 | 内容 |
|------|------|
| アプリ種別 | **Webアプリ（Flutter Web）** |
| 対応ブラウザ | Chrome、Safari、Edge（モバイルブラウザ含む） |
| ホスティング | Firebase Hosting |

---

### 1. ニックネーム入力画面

| 項目 | 内容 |
|------|------|
| 目的 | ユーザー識別用のニックネーム取得 |
| UI要素 | ニックネーム入力欄、「はじめる」ボタン |
| バリデーション | 空文字禁止、1〜20文字 |
| 処理 | ローカル保存（localStorage）→みんなの投稿一覧へ遷移 |
| 再訪時 | 保存済みなら自動でみんなの投稿一覧へ遷移 |

---

### 2. みんなの投稿一覧画面

| 項目 | 内容 |
|------|------|
| 目的 | 全ユーザーの俳句×画像投稿を閲覧 |
| レイアウト | Pinterestライク縦長フィード（Staggered Grid） |
| 画像サイズ | 4:5（Instagram縦長フィード比率） |
| 表示内容 | 生成画像、俳句テキスト、ニックネーム、投稿日時 |
| ソート | 新着順（createdAt DESC） |
| ページネーション | 無限スクロール |
| FAB | 右下にフローティングアクションボタン（+アイコン） |
| FAB押下 | 新規投稿作成画面へ遷移 |

---

### 3. 新規投稿作成画面

#### 3-1. 俳句入力

| 項目 | 内容 |
|------|------|
| 入力方式 | テキストフィールド（横書き） |
| バリデーション | 空文字禁止、文字数上限100文字 |
| プレースホルダー | 「俳句を入力してください」 |
| ボタン | 「画像を生成する」 |

#### 3-2. 画像生成

| 項目 | 内容 |
|------|------|
| 処理 | Flutter Web → 画像生成API → 画像データ取得 |
| UI | ローディングインジケーター + 「生成中...」 |
| 結果 | 生成画像をメモリ上に保持 |

#### 3-3. プレビュー・確認

| 項目 | 内容 |
|------|------|
| 表示 | 生成された画像 + 俳句テキスト |
| ボタン | 「投稿する」「再生成する」「キャンセル」 |

#### 3-4. 投稿処理

| 項目 | 内容 |
|------|------|
| Step 1 | 画像をFirebase Storageにアップロード |
| Step 2 | FirestoreにドキュメントCreate |
| 完了後 | トースト表示→みんなの投稿一覧へ遷移 |

---

### 4. 技術スタック

| 項目 | 技術 |
|------|------|
| フレームワーク | Flutter Web |
| ホスティング | Firebase Hosting |
| データベース | Cloud Firestore |
| ストレージ | Firebase Storage |
| ローカル保存 | localStorage（shared_preferences_web） |
| 画像生成API | DALL-E 3 / Gemini / Imagen（選定中） |
| 状態管理 | Riverpod |

---

### 5. データ設計（Firestore）

```
/posts/{postId}
  - nickname: string        // ニックネーム
  - haikuText: string       // 俳句テキスト
  - imageUrl: string        // Firebase Storage URL
  - createdAt: timestamp    // 作成日時
```

---

### 6. 画面遷移図

```
[ニックネーム入力画面]
       ↓ 「はじめる」タップ
[みんなの投稿一覧]
       ↓ FAB タップ
[新規投稿作成]
       ↓ 俳句入力 →「画像生成」
[画像生成中]
       ↓
[プレビュー・確認]
       ↓ 「投稿する」
[Storage保存 → Firestore保存]
       ↓
[みんなの投稿一覧へ戻る]
```

---

### 7. アーキテクチャ図

```
┌──────────────────────────────────────────┐
│         Flutter Web App                  │
│         (Firebase Hosting)               │
├──────────────────────────────────────────┤
│                                          │
│  [ニックネーム] → localStorageに保存      │
│                                          │
│  [俳句入力] → [画像生成API] → [プレビュー]│
│                                          │
│         「投稿する」タップ                │
│                ↓                         │
│      Firebase Storage（画像保存）         │
│                ↓                         │
│      Firestore（投稿データ保存）          │
│                                          │
└──────────────────────────────────────────┘
```

---

### 8. MVP機能一覧

| 優先度 | 機能 |
|--------|------|
| 🔴 Must | ニックネーム入力・保存（localStorage） |
| 🔴 Must | みんなの投稿一覧（ニックネーム表示） |
| 🔴 Must | 俳句入力→画像生成（API直接呼び出し） |
| 🔴 Must | プレビュー→Storage保存→投稿 |
| 🟡 Should | 再生成機能 |

